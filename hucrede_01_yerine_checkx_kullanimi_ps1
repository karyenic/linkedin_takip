# Ã–nce uygulamayÄ± durdurun (Ctrl+C)
# AÅŸaÄŸÄ±daki kodu linkedin_app.py dosyasÄ±na yapÄ±ÅŸtÄ±rÄ±n

$updatedCode = @'
import streamlit as st
import pandas as pd
import sqlite3
from datetime import datetime
import os
from pathlib import Path

# VeritabanÄ± iÅŸlemleri
def init_db():
    try:
        conn = sqlite3.connect('linkedin_takip.db', check_same_thread=False)
        c = conn.cursor()
        c.execute('''CREATE TABLE IF NOT EXISTS adaylar
                     (id INTEGER PRIMARY KEY AUTOINCREMENT,
                      isim TEXT, tarih TEXT, aciklama TEXT,
                      davet INTEGER, randevu INTEGER, plan INTEGER,
                      kayit INTEGER, takip INTEGER, hayir INTEGER,
                      is_ariyor INTEGER)''')
        conn.commit()
        conn.close()
    except Exception as e:
        st.error(f"VeritabanÄ± hatasÄ±: {e}")

def add_candidate(isim, tarih, aciklama, davet, randevu, plan, kayit, takip, hayir, is_ariyor):
    try:
        conn = sqlite3.connect('linkedin_takip.db', check_same_thread=False)
        c = conn.cursor()
        c.execute('''INSERT INTO adaylar (isim, tarih, aciklama, davet, randevu, plan, kayit, takip, hayir, is_ariyor)
                     VALUES (?,?,?,?,?,?,?,?,?,?)''', 
                  (isim, tarih, aciklama, int(davet), int(randevu), int(plan), 
                   int(kayit), int(takip), int(hayir), int(is_ariyor)))
        conn.commit()
        conn.close()
        return True
    except Exception as e:
        st.error(f"Ekleme hatasÄ±: {e}")
        return False

def get_all_candidates():
    try:
        conn = sqlite3.connect('linkedin_takip.db', check_same_thread=False)
        df = pd.read_sql_query("SELECT * FROM adaylar", conn)
        conn.close()
        return df
    except Exception as e:
        st.error(f"Veri okuma hatasÄ±: {e}")
        return pd.DataFrame()

# Streamlit arayÃ¼zÃ¼
def main():
    st.set_page_config(page_title="LinkedIn Takip AsistanÄ±", layout="wide")
    st.title("ğŸ“Š LinkedIn Takip AsistanÄ±")
    
    # VeritabanÄ±nÄ± baÅŸlat
    init_db()
    
    # Sidebar - Yeni aday ekleme
    with st.sidebar:
        st.header("Yeni Aday Ekle")
        isim = st.text_input("Ä°sim*", placeholder="AdayÄ±n adÄ± soyadÄ±")
        tarih = st.text_input("Tarih* (gg aa yy formatÄ±nda)", datetime.now().strftime("%d %m %y"))
        aciklama = st.text_area("AÃ§Ä±klama", placeholder="DetaylÄ± aÃ§Ä±klama...")
        
        # Tarih doÄŸrulama
        try:
            datetime.strptime(tarih, "%d %m %y")
            tarih_gecerli = True
        except ValueError:
            st.error("âŒ Tarih formatÄ± hatalÄ±! LÃ¼tfen 'gg aa yy' formatÄ±nda girin (Ã¶rn: 15 09 23)")
            tarih_gecerli = False
        
        st.subheader("Durumlar")
        col1, col2 = st.columns(2)
        with col1:
            davet = st.checkbox("Davet YapÄ±ldÄ±")
            randevu = st.checkbox("Randevu OluÅŸtu")
            plan = st.checkbox("Plan AnlatÄ±ldÄ±")
        with col2:
            kayit = st.checkbox("KayÄ±t")
            takip = st.checkbox("Takip")
            hayir = st.checkbox("HayÄ±r")
            is_ariyor = st.checkbox("Ä°ÅŸ ArÄ±yor")
        
        if st.button("âœ… Aday Ekle", type="primary"):
            if isim and tarih_gecerli:
                if add_candidate(isim, tarih, aciklama, davet, randevu, plan, kayit, takip, hayir, is_ariyor):
                    st.success("âœ… Aday baÅŸarÄ±yla eklendi!")
                    st.balloons()
                else:
                    st.error("âŒ Aday eklenemedi!")
            else:
                if not isim:
                    st.warning("âš ï¸ LÃ¼tfen isim giriniz!")
    
    # Ana iÃ§erik - Aday listesi
    st.header("Aday Listesi")
    df = get_all_candidates()
    
    if len(df) > 0:
        # Filtreleme
        st.subheader("Filtreleme")
        col1, col2, col3 = st.columns(3)
        with col1:
            filtre_davet = st.checkbox("Sadece Davet YapÄ±lanlar")
            filtre_randevu = st.checkbox("Sadece Randevu OluÅŸanlar")
        with col2:
            filtre_plan = st.checkbox("Sadece Plan AnlatÄ±lanlar")
            filtre_kayit = st.checkbox("Sadece KayÄ±t Olanlar")
        with col3:
            filtre_is_ariyor = st.checkbox("Sadece Ä°ÅŸ Arayanlar")
            filtre_takip = st.checkbox("Sadece Takip Edilenler")
        
        # Filtreleme iÅŸlemi
        if filtre_davet:
            df = df[df['davet'] == 1]
        if filtre_randevu:
            df = df[df['randevu'] == 1]
        if filtre_plan:
            df = df[df['plan'] == 1]
        if filtre_kayit:
            df = df[df['kayit'] == 1]
        if filtre_is_ariyor:
            df = df[df['is_ariyor'] == 1]
        if filtre_takip:
            df = df[df['takip'] == 1]
        
        # GÃ¶sterim iÃ§in DataFrame oluÅŸtur (âœ“ ve X iÃ§in)
        display_df = df.copy()
        checkbox_columns = ['davet', 'randevu', 'plan', 'kayit', 'takip', 'hayir', 'is_ariyor']
        for col in checkbox_columns:
            display_df[col] = display_df[col].apply(lambda x: 'âœ“' if x == 1 else 'âœ—')
        
        # Renkli tablo gÃ¶sterimi
        def color_cells(val):
            if val == 'âœ“':
                return 'background-color: #90EE90; color: #006400; font-weight: bold;'  # AÃ§Ä±k yeÅŸil
            elif val == 'âœ—':
                return 'background-color: #FFCCCB; color: #8B0000;'  # AÃ§Ä±k kÄ±rmÄ±zÄ±
            return ''
        
        styled_df = display_df.style.applymap(color_cells, subset=checkbox_columns)
        st.dataframe(styled_df, use_container_width=True, height=400)
        
        # Silme butonu
        if st.button("ğŸ—‘ï¸ TÃ¼m Verileri Sil"):
            try:
                conn = sqlite3.connect('linkedin_takip.db', check_same_thread=False)
                c = conn.cursor()
                c.execute("DELETE FROM adaylar")
                conn.commit()
                conn.close()
                st.success("TÃ¼m veriler silindi!")
                st.experimental_rerun()
            except Exception as e:
                st.error(f"Silme hatasÄ±: {e}")
    else:
        st.info("ğŸ“ HenÃ¼z hiÃ§ aday eklenmemiÅŸ. Sol taraftan yeni aday ekleyebilirsiniz.")
    
    # Raporlama Paneli
    st.header("ğŸ“ˆ Raporlama Paneli")
    
    if len(df) > 0:
        total_aday = len(df)
        davet_yapilan = df['davet'].sum()
        randevu_olusan = df['randevu'].sum()
        plan_anlatilan = df['plan'].sum()
        kayit_olan = df['kayit'].sum()
        takip_edilen = df['takip'].sum()
        hayir_diyen = df['hayir'].sum()
        is_ariyor = df['is_ariyor'].sum()

        davet_randevu_oran = (randevu_olusan / davet_yapilan * 100) if davet_yapilan > 0 else 0
        plan_kayit_oran = (kayit_olan / plan_anlatilan * 100) if plan_anlatilan > 0 else 0

        col1, col2, col3, col4 = st.columns(4)
        with col1:
            st.metric(label="ğŸ‘¥ Toplam Aday", value=total_aday)
            st.metric(label="ğŸ‘ KayÄ±t Olan", value=kayit_olan)
        with col2:
            st.metric(label="âœ‰ï¸ Davet YapÄ±lan", value=davet_yapilan)
            st.metric(label="ğŸ“ Randevu OluÅŸan", value=randevu_olusan)
        with col3:
            st.metric(label="ğŸ—“ï¸ Plan AnlatÄ±lan", value=plan_anlatilan)
            st.metric(label="â¡ï¸ Takip Edilen", value=takip_edilen)
        with col4:
            st.metric(label="ğŸ’¼ Ä°ÅŸ ArÄ±yor", value=is_ariyor)
            st.metric(label="ğŸ‘ HayÄ±r Diyen", value=hayir_diyen)

        st.divider()
        st.subheader("DÃ¶nÃ¼ÅŸÃ¼m OranlarÄ±")
        col_oran1, col_oran2 = st.columns(2)
        with col_oran1:
            st.metric(label="Davetten Randevuya DÃ¶nÃ¼ÅŸÃ¼m OranÄ±", value=f"{davet_randevu_oran:.1f}%")
        with col_oran2:
            st.metric(label="Plan AnlatÄ±mÄ±ndan KayÄ±ta DÃ¶nÃ¼ÅŸÃ¼m OranÄ±", value=f"{plan_kayit_oran:.1f}%")
    else:
        st.warning("Rapor oluÅŸturmak iÃ§in henÃ¼z veri girilmemiÅŸ.")

if __name__ == "__main__":
    main()
'@

Set-Content -Path "C:\YEDEK\linkedin\linkedin_app.py" -Value $updatedCode -Encoding UTF8

# UygulamayÄ± yeniden baÅŸlatÄ±n
streamlit run C:\YEDEK\linkedin\linkedin_app.py